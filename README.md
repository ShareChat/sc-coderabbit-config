# CodeRabbit Configuration Repository

A comprehensive, production-ready configuration for [CodeRabbit](https://coderabbit.ai/) that provides intelligent code review guidance for multiple technologies and best practices. This repository includes a Go-based merge tool that automatically generates comprehensive CodeRabbit configurations from technology-specific instruction files.

## 🚀 Features

### **Automatic Labeling**
- **Smart PR Classification**: Automatically applies relevant labels based on PR content
- **Technology-Specific Labels**: `feature`, `bugfix`, `refactor`, `documentation`, `chore`, `tests`

### **Comprehensive Technology Coverage**
- **Temporal Workflows & Activities** - Best practices for workflow orchestration
- **Redis & Caching** - Performance and security guidelines
- **HTTP Clients** - Connection pooling and timeout management
- **Apache Kafka** - Producer/consumer optimization
- **PostgreSQL/CloudSQL** - Database performance and security
- **Google Spanner** - Distributed database best practices
- **ScyllaDB** - NoSQL database optimization

### **Intelligent Path Matching with Auto-Generation**
- **Dual Pattern Strategy**: Automatically generates both file and directory patterns
- **Case-Insensitive**: Works regardless of naming conventions
- **Flexible Patterns**: Matches both file names and directory structures
- **Comprehensive Coverage**: Catches files like `/src/redis/main.go`, `redis_client.py`, etc.

## 🏗️ Project Structure

```
sc-coderabbit-config/
├── cmd/
│   └── merge/
│       └── main.go              # Go merge tool
├── configs/                      # Technology-specific configurations
│   ├── http/
│   │   └── path_instructions.yaml
│   ├── kafka/
│   │   └── path_instructions.yaml
│   ├── redis/
│   │   └── path_instructions.yaml
│   ├── scylla/
│   │   └── path_instructions.yaml
│   ├── spanner/
│   │   └── path_instructions.yaml
│   ├── sql/
│   │   └── path_instructions.yaml
│   ├── temporal/
│   │   └── path_instructions.yaml
│   └── README.md
├── go.mod                        # Go module definition
├── go.sum                        # Go dependencies
├── Makefile                      # Build and automation commands
└── README.md                     # This file
```

## 🔧 Quick Start

### **Prerequisites**
- Go 1.21 or later
- Make (optional, for convenience)

### **Installation & Setup**

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd sc-coderabbit-config
   ```

2. **Install dependencies**:
   ```bash
   make deps
   # or manually:
   go mod tidy
   go mod download
   ```

3. **Build the merge tool**:
   ```bash
   make build
   ```

4. **Generate CodeRabbit configuration**:
   ```bash
   make run
   ```

## 🛠️ Build & Usage

### **Available Commands**

| Command | Description |
|---------|-------------|
| `make build` | Build the merge tool binary |
| `make run` | Build and run (outputs to `.coderabbit.yaml`) |
| `make run-custom` | Build and run with custom output file |
| `make clean` | Remove build artifacts |
| `make deps` | Install Go dependencies |
| `make test` | Run tests |
| `make help` | Show detailed help |

### **Manual Usage**

```bash
# Build manually
go build -o bin/merge cmd/merge/main.go

# Run with default output (.coderabbit.yaml)
./bin/merge configs/

# Run with custom output file
./bin/merge configs/ my-coderabbit.yaml

# Run directly without building
go run cmd/merge/main.go configs/
```

## 🔧 Configuration Details

### **Path Pattern Strategy**

Each technology uses **dual patterns** for maximum coverage, automatically generated by the merge tool:

1. **Directory Pattern**: `**/{keyword1,keyword2}*/**` - Matches files in directories with keywords
2. **File Pattern**: `**/*{keyword1*,keyword2*}*` - Matches files containing keywords

#### **Examples of What Gets Matched:**

| Technology | Directory Pattern | Auto-Generated File Pattern | Examples |
|------------|-------------------|------------------------------|----------|
| **Temporal** | `**/{temporal,workflow,activity}*/**` | `**/*{temporal*,workflow*,activity*}*` | `/src/temporal/`, `workflow_engine.py` |
| **Redis** | `**/{redis,df,dragonfly}*/**` | `**/*{redis*,df*,dragonfly*}*` | `/src/redis/`, `cache_manager.ts` |
| **HTTP** | `**/{http,client,api,network}*/**` | `**/*{http*,client*,api*,network*}*` | `/services/http/`, `api_service.go` |
| **Kafka** | `**/{kafka,producer,consumer}*/**` | `**/*{kafka*,producer*,consumer*}*` | `/src/kafka/`, `stream_processor.ts` |
| **PostgreSQL** | `**/{postgres,postgresql,db}*/**` | `**/*{postgres*,postgresql*,db*}*` | `/lib/postgres/`, `database_manager.go` |
| **Spanner** | `**/{spanner,spannerdb}*/**` | `**/*{spanner*,spannerdb*}*` | `/src/spanner/`, `spanner_service.ts` |
| **ScyllaDB** | `**/{scylla,scylladb}*/**` | `**/*{scylla*,scylladb*}*` | `/src/scylla/`, `scylla_manager.go` |

### **Adding New Technologies**

1. **Create a new directory**:
   ```bash
   mkdir configs/newtech
   ```

2. **Create `path_instructions.yaml`**:
   ```yaml
   # New Technology Best Practices
   - path: "**/{newtech,related,keywords}*/**"
     instructions: |
       **General New Technology Best Practices:**
       Your review instructions here...
   ```

3. **Run the merge tool**:
   ```bash
   make run
   ```

The merge tool automatically:
- Reads all `path_instructions.yaml` files
- Generates file-based patterns from directory patterns
- Merges everything into the final `.coderabbit.yaml`
- Applies proper YAML formatting and indentation

### **Modifying Existing Patterns**

- **Change Keywords**: Update the glob patterns in `path` fields
- **Update Instructions**: Modify the `instructions` content for your needs
- **Adjust Thresholds**: Modify `metrics` section for performance rules

### **Performance Tuning**

```yaml
metrics:
  function_complexity:
    threshold: 15        # Adjust based on your team's standards
    enabled: true
  
  function_length:
    threshold: 150       # Adjust based on your team's standards
    enabled: true
```

## 📊 Best Practices

### **For Teams**
- **Start Small**: Begin with core technologies your team uses most
- **Iterate**: Refine patterns based on review feedback
- **Document**: Keep instructions clear and actionable
- **Review Regularly**: Update configuration as your tech stack evolves

### **For Repositories**
- **Consistent Naming**: Use clear, descriptive file and directory names
- **Technology Separation**: Organize code by technology domain
- **Documentation**: Include README files in technology-specific directories

## 🔍 Troubleshooting

### **Common Issues**

1. **Paths Not Matching**
   - Check glob pattern syntax
   - Verify case sensitivity
   - Test with sample file paths

2. **Instructions Not Triggering**
   - Ensure each `path` has `instructions`
   - Check YAML indentation
   - Validate YAML syntax

3. **Build Issues**
   - Ensure Go 1.21+ is installed
   - Run `make deps` to install dependencies
   - Check Go module configuration

### **Debugging Tips**

- **Test Patterns**: Use tools like [globster](https://globster.xyz/) to test glob patterns
- **Check Logs**: Review CodeRabbit logs for pattern matching issues
- **Validate YAML**: Use online YAML validators to check syntax

## 🤝 Contributing

We welcome contributions! Here's how you can help:

1. **Report Issues**: Open an issue for bugs or feature requests
2. **Suggest Improvements**: Propose new technology patterns or best practices
3. **Submit PRs**: Contribute new patterns or improve existing ones
4. **Share Knowledge**: Help improve documentation and examples

### **Contribution Guidelines**

- Follow existing code style and structure
- Include clear descriptions of changes
- Test patterns with sample file paths
- Update documentation as needed
- Ensure the merge tool builds and runs correctly

### **Development Workflow**

1. **Fork and clone** the repository
2. **Create a feature branch** for your changes
3. **Add/modify** technology configurations in `configs/`
4. **Test** with `make run` to ensure proper generation
5. **Submit a PR** with clear description of changes

## 📚 Resources

### **Official Documentation**
- [CodeRabbit Documentation](https://docs.coderabbit.ai/)
- [YAML Configuration Guide](https://docs.coderabbit.ai/configuration)
- [Path Pattern Examples](https://docs.coderabbit.ai/configuration/path-instructions)

### **Related Tools**
- [Go Programming Language](https://golang.org/)
- [YAML v3](https://pkg.go.dev/gopkg.in/yaml.v3)
- [Make](https://www.gnu.org/software/make/)
